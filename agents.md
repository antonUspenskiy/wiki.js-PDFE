Эта программа экспортирует веб-страницы wiki.js в PDF-документы, сохраняя оригинальные стили и при этом адаптируя верстку под PDF (переносы таблиц и заголовков, корректная работа с изображениями и т.д.).

За экспорт отвечают два основных файла:
- `Export.js` — экспорт одной страницы;
- `export-all.js` — экспорт всех страниц.

Их функционал по формированию PDF должен оставаться идентичным. Разница допустима только в оркестрации: одна страница или пакетный запуск по всем страницам.

Обязательные правила для `export-all`:
- `export-all.js` не дублирует PDF-логику, а вызывает `Export.js` для каждой страницы.
- При запуске `Export.js` в режиме `export-all` аргументы CLI (`--base`, `--article`, `--url`) имеют приоритет над `config.json`.
- `pageUrl` из `config.json` не должен перезаписывать `--base`/`--article` в массовом экспорте.
- Массовый экспорт должен быть инкрементальным: генерировать отсутствующие PDF и пересобирать только устаревшие.
- Актуальность проверяется по `updatedAt` страницы wiki.js и локальному `*.pdf.meta.json` (с fallback на `mtime` файла).
- Структура директорий в `output` должна зеркалировать пути страниц wiki.js.
- Логи должны явно отражать действия: `create`, `update`, `skip`, `error`, и итоговую сводку.

Целевой сценарий эксплуатации — Linux + cron (`--base`, `--apikey`, `--output`).

## Футноты и колонтитулы (обязательные правила)

- Футноты из основного тела страницы удаляются из PDF и переносятся в нижний колонтитул соответствующей страницы.
- Нумерация футнотов и ссылок на них выполняется отдельно для каждой страницы и начинается с `1`.
- Ссылки на футноты в тексте должны оставаться кликабельными и вести на свою сноску в колонтитуле.
- Ссылки, находящиеся внутри текста футнота (внешние и внутренние), должны сохранять кликабельность.
- Формат номера в колонтитуле:
  - одиночная сноска: `N. Текст`;
  - объединённая сноска: `N, M Текст` (например, `3, 4`).
- Объединение нескольких номеров в одну строку футнота допускается только для соседних ссылок на странице (contiguous refs), если они указывают на одну и ту же сноску/эквивалентный текст.
- Несоседние ссылки не объединяются: если между ними есть другая сноска, нужно выводить отдельные строки (например, `2`, `3`, `4`, а не `2, 4`).
- Базовая высота зоны футнотов в колонтитуле — `25 мм`; шрифт футнотов меньше основного текста; при переполнении высота колонтитула увеличивается динамически.

## Размер шрифта (обязательные правила)

- Настройка размера шрифта должна работать без обязательной передачи CLI-параметров на каждом запуске.
- Постоянные значения задаются в `config.json`:
  - `fontSize` — базовый размер шрифта основного текста (px);
  - `footnoteFontSize` — размер шрифта футнотов в колонтитуле (pt).
- CLI-параметры `--font-size` и `--footnote-font-size` используются как опциональные override для текущего запуска и имеют приоритет над `config.json`.
- Если `fontSize` задан, в `Export.js` он применяется к `html, body` в print-стилях, а автоматический `pdfOptions.scale` фиксируется в `1`, чтобы размер шрифта визуально не компенсировался автоскейлом.
- Если `fontSize` не задан, используется исходный размер из стилей страницы и текущий алгоритм auto-scale.
- Логика управления шрифтом должна быть идентичной для одиночного и массового экспорта: `export-all.js` только прокидывает значения в `Export.js`, не дублируя PDF-логику.

## Таблицы и изображения (обязательные правила)

- По умолчанию сохраняется нативная геометрия таблицы из исходной страницы (`table-layout`, `colgroup`, `width` в ячейках/контенте не «перезатираются» глобально).
- Жесткая нормализация таблицы допускается только для реально переполненных таблиц (overflow), а не для всех таблиц с изображениями.
- Переполнение определяется относительно ширины печатного контент-корня (print root): если таблица визуально шире доступной области или имеет `scrollWidth` больше доступной ширины.
- Только для overflow-таблиц можно применять усиленные ограничения: `table-layout: fixed`, `width/max-width: 100%`, `min-width: 0` для ячеек, агрессивный перенос длинных слов.
- Для обычных таблиц с изображениями сохраняется исходная логика выравнивания и размеров; нельзя принудительно делать их «узкими» или «фиксированными» без признака overflow.
- Центрирование изображения в ячейке выполняется только когда ячейка по сути медиа-ячейка (без значимого текстового контента). В смешанных ячейках выравнивание не ломается.
- Нельзя использовать глобальный `overflow-x: hidden` на корневом печатном контейнере как способ борьбы с переполнением таблиц.
- Изменения логики таблиц/изображений в `Export.js` считаются частью общей PDF-логики и должны автоматически сохраняться идентичными для одиночного и массового экспорта (через запуск `Export.js` из `export-all.js`).